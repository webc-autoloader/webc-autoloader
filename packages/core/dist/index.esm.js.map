{"version":3,"file":"index.esm.js","sources":["../src/importmap.ts","../src/webc.ts","../src/config.ts","../src/autoload.ts","../src/handler.ts"],"sourcesContent":["import { IImportMap, IKeyInfo, ILoadMap, IPrefixMap } from \"./types.js\";\r\n\r\nconst COMPONENT_KEYWORD = \"@components/\";\r\n\r\nexport function loadImportmap(): IImportMap | null {\r\n  const importmap: IImportMap = { imports: {} };\r\n  document.querySelectorAll('script[type=\"importmap\"]').forEach((script) => {\r\n    try {\r\n      const json = JSON.parse(script.innerHTML);\r\n      if (json.imports) {\r\n        importmap.imports = Object.assign(importmap.imports, json.imports);\r\n      }\r\n    } catch (e) {\r\n      throw new Error(\"Failed to parse importmap JSON: \" + e);\r\n    }\r\n  });\r\n  return Object.keys(importmap.imports).length > 0\r\n    ? importmap\r\n    : null;\r\n}\r\n\r\nfunction getKeyInfoFromImportmapKey(key: string): IKeyInfo | null {\r\n  if (key.startsWith(COMPONENT_KEYWORD)) {\r\n    if (key.endsWith(\"/\")) {\r\n      const prefixWithLoader = key.slice(COMPONENT_KEYWORD.length, key.length - 1);\r\n      const [ prefix, loaderKey ] = prefixWithLoader.split(\"|\", 2);\r\n      if (prefix === \"\") {\r\n        throw new Error(\"Invalid importmap key: \" + key);\r\n      }\r\n      return {\r\n        key,\r\n        prefix: prefix.replaceAll(\"/\", \"-\").toLowerCase(),\r\n        loaderKey: loaderKey ?? null,\r\n        isNameSpaced: true\r\n      };\r\n    } else {\r\n      const tagNamePart = key.slice(COMPONENT_KEYWORD.length);\r\n      const [ tagName, loaderKeyPart ] = tagNamePart.split(\"|\", 2);\r\n      const [ loaderKey, extendsText ] = (loaderKeyPart ?? \"\").split(\",\", 2);\r\n      if (tagName === \"\") {\r\n        throw new Error(\"Invalid importmap key: \" + key);\r\n      }\r\n      return {\r\n        key,\r\n        tagName: tagName.replaceAll(\"/\", \"-\").toLowerCase(),\r\n        loaderKey: loaderKey ?? null,\r\n        extends: extendsText ?? null,\r\n        isNameSpaced: false\r\n      };\r\n    }\r\n  }\r\n  return null;\r\n}\r\n\r\nexport function buildMap(importmap: IImportMap): {\r\n  prefixMap: IPrefixMap, loadMap: ILoadMap\r\n} {\r\n  const prefixMap: IPrefixMap = {};\r\n  const loadMap: ILoadMap = {};\r\n  for (const [key, value] of Object.entries(importmap.imports)) {\r\n    const keyInfo = getKeyInfoFromImportmapKey(key);\r\n    if (keyInfo === null) {\r\n      continue;\r\n    }\r\n    if (keyInfo.isNameSpaced) {\r\n      prefixMap[keyInfo.prefix] = keyInfo;\r\n    } else {\r\n      loadMap[keyInfo.tagName] = keyInfo;\r\n    }\r\n  }\r\n  return { prefixMap, loadMap };\r\n}","\r\n\r\nexport async function load(path: string): Promise<CustomElementConstructor> {\r\n  const module = await import(path);\r\n  return module.default as CustomElementConstructor;\r\n}","\r\nimport { IConfig } from \"./types.js\"\r\nimport { load } from \"./webc.js\"\r\n\r\nexport const DEFAULT_KEY = \"*\";\r\n\r\nexport const WEBC_KEY = \"webc\";\r\n\r\nexport const WEBC_LOADER = {\r\n  postfix: \".webc.js\",\r\n  loader: load\r\n}\r\n\r\nexport const DEFAULT_CONFIG: IConfig = {\r\n  scanImportmap: true,\r\n  loaders: {\r\n    [WEBC_KEY]: WEBC_LOADER,\r\n    [DEFAULT_KEY]: WEBC_KEY\r\n  },\r\n  observable: true\r\n}\r\n","import { DEFAULT_KEY } from \"./config.js\";\r\nimport { IEagerLoadInfo, ILoader, INameSpaceInfo, IPrefixMap, ITagInfo } from \"./types.js\";\r\n\r\nconst failedTags = new Set<string>();\r\nconst loadingTags = new Set<string>();\r\n\r\nfunction getTagInfoFromElement(e: Element): ITagInfo {\r\n  let elementTagName = e.tagName.toLowerCase();\r\n  let name;\r\n  let extendsName;\r\n  if (elementTagName.includes(\"-\")) {\r\n    name = elementTagName;\r\n    extendsName = null;\r\n  } else {\r\n    const tagName = e.getAttribute(\"is\");\r\n    if (tagName === null) {\r\n      throw new Error(\"Custom element without a dash or 'is' attribute found: \" + elementTagName);\r\n    }\r\n    if (!tagName.includes(\"-\")) {\r\n      throw new Error(\"Custom element 'is' attribute without a dash found: \" + elementTagName);\r\n    }\r\n    name = tagName;\r\n    extendsName = elementTagName;\r\n  }\r\n  return { name, extends: extendsName };\r\n}\r\n\r\nfunction matchNameSpace(tagName: string, prefixMap: IPrefixMap): INameSpaceInfo | null {\r\n  for (const [prefix, info] of Object.entries(prefixMap)) {\r\n    if (tagName.startsWith(prefix + \"-\")) {\r\n      return info;\r\n    }\r\n  }\r\n  return null;\r\n}\r\n\r\nexport async function lazyLoad(\r\n  root: Document | ShadowRoot, \r\n  prefixMap: IPrefixMap,\r\n  loaders: Record<string, ILoader | string>\r\n): Promise<void> {\r\n  let elements = root.querySelectorAll(':not(:defined)');\r\n  const duplicateCheck = new Set<string>(); // UpperCase tag names\r\n  for(const element of elements) {\r\n    const tagName = element.tagName;\r\n    if (duplicateCheck.has(tagName)) {\r\n      continue;\r\n    }\r\n    duplicateCheck.add(tagName);\r\n    const { name, extends: extendsName } = getTagInfoFromElement(element);\r\n    if (failedTags.has(name)) {\r\n      continue;\r\n    }\r\n    if (loadingTags.has(name)) {\r\n      continue;\r\n    }\r\n    let info: INameSpaceInfo | null = matchNameSpace(name, prefixMap);\r\n    if (info === null) {\r\n      throw new Error(\"No matching namespace found for lazy loaded component: \" + name);\r\n    }\r\n    let loader: ILoader | string;\r\n    if (info.loaderKey === null || info.loaderKey === DEFAULT_KEY || info.loaderKey === \"\") {\r\n      loader = loaders[DEFAULT_KEY];\r\n      if (typeof loader === \"string\") {\r\n        loader = loaders[loader];\r\n      }\r\n    } else {\r\n      loader = loaders[info.loaderKey];\r\n    }\r\n    if (typeof loader === \"string\") {\r\n      throw new Error(\"Loader redirection is not supported for eager loaded components: \" + tagName);\r\n    }\r\n    loadingTags.add(name);\r\n\r\n    let file: string = name.slice(info.prefix.length + 1);\r\n    if (file === \"\") {\r\n      throw new Error(\"Invalid component name for lazy loaded component: \" + name);\r\n    }\r\n    const path = info.key + file + loader.postfix;\r\n    try {\r\n      const componentConstructor = await loader.loader(path);\r\n      if (componentConstructor !== null) {\r\n        if (extendsName === null) {\r\n          customElements.define(name, componentConstructor);\r\n        } else {\r\n          customElements.define(name, componentConstructor, { extends: extendsName });\r\n        }\r\n      }\r\n    } catch(e) {\r\n      if (!failedTags.has(name)) {\r\n        console.error(`Failed to lazy load component '${name}':`, e);\r\n        failedTags.add(name);\r\n      }\r\n    } finally {\r\n      loadingTags.delete(name);\r\n    }\r\n  }\r\n}\r\n\r\nexport async function eagerLoad(\r\n  loadMap: Record<string, IEagerLoadInfo>, \r\n  loaders: Record<string, ILoader | string>\r\n): Promise<void> {\r\n  for(const [tagName, info] of Object.entries(loadMap)) {\r\n    let loader: ILoader | string;\r\n    if (info.loaderKey === null || info.loaderKey === DEFAULT_KEY || info.loaderKey === \"\") {\r\n      loader = loaders[DEFAULT_KEY];\r\n      if (typeof loader === \"string\") {\r\n        loader = loaders[loader];\r\n      }\r\n    } else {\r\n      loader = loaders[info.loaderKey];\r\n    }\r\n    if (typeof loader === \"string\") {\r\n      throw new Error(\"Loader redirection is not supported for eager loaded components: \" + tagName);\r\n    }\r\n    try {\r\n      const componentConstructor = await loader.loader(info.key);\r\n      if (componentConstructor !== null) {\r\n        if (info.extends === null) {\r\n          customElements.define(tagName, componentConstructor);\r\n        } else {\r\n          customElements.define(tagName, componentConstructor, { extends: info.extends });\r\n        }\r\n      }\r\n    } catch(e) {\r\n      if (!failedTags.has(tagName)) {\r\n        console.error(`Failed to eager load component '${tagName}':`, e);\r\n        failedTags.add(tagName);\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { buildMap, loadImportmap } from \"./importmap.js\";\r\nimport { DEFAULT_CONFIG as config } from \"./config.js\";\r\nimport { eagerLoad, lazyLoad } from \"./autoload.js\";\r\n\r\nexport async function registerHandler(): Promise<void> {\r\n  const importmap = loadImportmap(); // 事前に importmap を読み込んでおく\r\n  if (importmap === null) {\r\n    return;\r\n  }\r\n  const { prefixMap, loadMap } = buildMap(importmap);\r\n  // 先にeager loadを実行すると、DOMContentLoadedイベントが発生しないことがあるため、後に実行する\r\n\r\n  document.addEventListener(\"DOMContentLoaded\", async (): Promise<void> => {\r\n    if (Object.keys(prefixMap).length === 0) {\r\n      return;\r\n    }\r\n    try {\r\n      await lazyLoad(document, prefixMap, config.loaders);\r\n    } catch(e) {\r\n      throw new Error(\"Failed to lazy load components: \" + e);\r\n    }\r\n\r\n    if (!config.observable) {\r\n      return;\r\n    }\r\n    const mo = new MutationObserver(async (): Promise<void> => {\r\n      try {\r\n        await lazyLoad(document, prefixMap, config.loaders);\r\n      } catch(e) {\r\n        throw new Error(\"Failed to lazy load components: \" + e);\r\n      }\r\n    });\r\n    mo.observe(document.documentElement, { childList: true, subtree: true });\r\n  });\r\n\r\n  try {\r\n    await eagerLoad(loadMap, config.loaders);\r\n  } catch(e) {\r\n    throw new Error(\"Failed to eager load components: \" + e);\r\n  }\r\n}\r\n\r\n"],"names":["config"],"mappings":"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"}